{% extends 'layout.html.twig' %}

{% block main %}

<div class="alert alert-info">
    You have injected {{ trained + untrained }} skills, trained {{ trained }} and have {{ skillpoints|number_format }} skillpoints.
</div>

<table class="table">
    <thead>
        <tr class="bg-faded">
            <th width="25%"></th>
            <th>skill</th>
        </tr>
        <tr>
            <td>
                <div class="input-group">
                    <select class="form-control" id="filter-by-level" aria-describedby="Filter by level">
                        <option value="-1">Unfiltered</option>
                        <option value="0">Untrained</option>
                        <option value="1">Level 1 skills</option>
                        <option value="2">Level 2 skills</option>
                        <option value="3">Level 3 skills</option>
                        <option value="4">Level 4 skills</option>
                        <option value="5">Level 5 skills</option>
                    </select>
                    <span class="input-group-addon">filter by level</span>
                </div>
            </td>
            <td>
                <div class="input-group">
                    <input type="text" class="form-control" id="filter-by-name" aria-describedby="Filter by name">
                    <span class="input-group-addon">filter by name</span>
                </div>
            </td>
        </tr>
    </thead>
    <tbody>
    {% for group in tree %}
        <tr class="table-active">
            <td colspan="2">{{ group.name }}</td>
        </tr>
    {% for skill in group._children %}
        <tr data-skill-level="{% if skills[skill.type_id] is defined %}{{ skills[skill.type_id].current_skill_level }}{% else %}0{% endif %}">
            <td class="px-0">
                {% if skills[skill.type_id] is not defined %}
                {% else %}
                {% for i in 1..5 %}
                <div class="progress w-18 d-inline-flex">
                {% if skills[skill.type_id].current_skill_level >= i %}
                    <div class="progress-bar" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                {% else %}
                    <div class="progress-bar" role="progressbar" style="width: 0" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                {% endif %}
                </div>
                {% endfor %}
                {% endif %}
            </td>
            <td>{{ skill.name }}</td>
        </tr>
    {% endfor %}
    {% endfor %}
    </tbody>
</table>

{% endblock %}

{% block script %}

<script type="text/javascript">
    $(document).ready(function () {

        (function ($) {

            $('#filter-by-name').keyup(function () {

                $('#filter-by-level input').removeAttr('selected');
                $('#filter-by-level option:first-child').attr('selected', 'selected');

                var rex = new RegExp($(this).val(), 'i');
                var rows = $('.table tbody tr[data-skill-level]');
                rows.hide();
                rows.filter(function () {
                    return rex.test($(this).text());
                }).show();

            });

            $('#filter-by-level').change(function () {

                $('#filter-by-name').val('');

                var rows = $('.table tbody tr[data-skill-level]');
                var value = $(this).val();
                rows.hide();

                if (-1 == value) {
                    rows.show();
                } else {
                    rows.filter('[data-skill-level="' + value + '"]').show();
                }
            });

        }(jQuery));

    });
</script>

{% endblock %}
